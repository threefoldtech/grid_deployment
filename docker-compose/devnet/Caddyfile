# Caddy config file to expose all required grid services
tfchain.bknd1.dev.ava.tf {
        reverse_proxy tfchain-public-node:9944 {
                header_up Host {upstream_hostport}
        }
                metrics /metrics
        log {
                output file /var/log/caddy/caddy_access_tfchain.log
                format json
        }
        tls info@threefold.tech
}

graphql.bknd1.dev.ava.tf {
        reverse_proxy processor_query_node:4000 {
                header_up Host {upstream_hostport}
        }
        log {
                output file /var/log/caddy/caddy_access_graphql.log
                format json
        }
        tls info@threefold.tech
}

gridproxy.bknd1.dev.ava.tf {
        reverse_proxy grid_proxy:443 {
                header_up Host {upstream_hostport}
        }
        log {
                output file /var/log/caddy/caddy_access_gridproxy.log
                format json
        }
        tls info@threefold.tech
}

activation.bknd1.dev.ava.tf {
        reverse_proxy grid_activation_service:3000 {
                header_up Host {upstream_hostport}
        }
        log {
                output file /var/log/caddy/caddy_access_activation.log
                format json
        }
        tls info@threefold.tech
}

dashboard.bknd1.dev.ava.tf {
        reverse_proxy grid_dashboard:80 {
                header_up Host {upstream_hostport}
        }
        log {
                output file /var/log/caddy/caddy_access_dashboard.log
                format json
        }
        tls info@threefold.tech
}

play.bknd1.dev.ava.tf {
        reverse_proxy grid_weblets:80 {
                header_up Host {upstream_hostport}
        }
        log {
                output file /var/log/caddy/caddy_access_play.log
                format json
        }
        tls info@threefold.tech
}
